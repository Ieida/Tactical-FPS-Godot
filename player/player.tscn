[gd_scene load_steps=20 format=3 uid="uid://cwtrpjm3y5u7k"]

[ext_resource type="Script" path="res://player/player.gd" id="1_ugqs2"]
[ext_resource type="PackedScene" uid="uid://d2fpiuj2xxby6" path="res://nausea/nausea.tscn" id="2_135jv"]
[ext_resource type="Script" path="res://player_character/player_character.gd" id="2_bxk1o"]
[ext_resource type="Script" path="res://player_camera/player_camera.gd" id="2_jgt6g"]
[ext_resource type="Script" path="res://player_weapon/player_weapon.gd" id="4_pbdc1"]
[ext_resource type="PackedScene" uid="uid://r60v8078b8a7" path="res://pistol/pistol.tscn" id="4_ujl8y"]
[ext_resource type="PackedScene" uid="uid://dgueiygo0ljxc" path="res://health/health.tscn" id="5_v7jk3"]
[ext_resource type="Script" path="res://magazine/magazine.gd" id="6_7fstl"]
[ext_resource type="PackedScene" uid="uid://d4bhp4yeabe7e" path="res://bullet/bullet.tscn" id="7_i1ag6"]
[ext_resource type="PackedScene" uid="uid://483bq5b351pk" path="res://smg/smg.tscn" id="8_6ao76"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_yy7gy"]
height = 1.5

[sub_resource type="SeparationRayShape3D" id="SeparationRayShape3D_d8cd5"]

[sub_resource type="Animation" id="Animation_2qp58"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("SMG:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0.05, -0.08, -0.22)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("SMG:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(0, 0, 0.165806)]
}

[sub_resource type="Animation" id="Animation_bu5vc"]
resource_name = "rack_slide"
length = 0.1
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("SMG:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.05, 0.1),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Vector3(0.05, -0.08, -0.22), Vector3(0.05, -0.08, -0.2), Vector3(0.05, -0.08, -0.22)]
}

[sub_resource type="Animation" id="Animation_tqkit"]
resource_name = "recoil"
length = 0.3
step = 0.02
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("SMG:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.04, 0.08, 0.12, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.05, -0.08, -0.22), Vector3(0.05, -0.08, -0.195), Vector3(0.05, -0.08, -0.22), Vector3(0.05, -0.08, -0.225), Vector3(0.05, -0.08, -0.22)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("SMG:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.04, 0.08, 0.12, 0.3),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 0, 0.165806), Vector3(0.0238237, -1.83981e-10, 0.165806), Vector3(0, 0, 0.165806), Vector3(0.00626573, -3.04825e-10, 0.165806), Vector3(0, 0, 0.165806)]
}

[sub_resource type="Animation" id="Animation_g7t13"]
resource_name = "reload"
length = 2.0
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("SMG:position")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.3, 1.6, 1.7, 1.8, 2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0.05, -0.08, -0.22), Vector3(0.163392, -0.08, -0.22), Vector3(0.0347883, -0.199328, -0.22), Vector3(0.0347883, -0.199328, -0.22), Vector3(0.0347883, -0.176807, -0.22), Vector3(0.0347883, -0.199328, -0.22), Vector3(0.05, -0.08, -0.22)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("SMG:rotation")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1, 0.3, 1.6, 1.7, 1.8, 2),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1),
"update": 0,
"values": [Vector3(0, 0, 0.165806), Vector3(8.08004e-09, -0.468254, 1.10502), Vector3(-0.395111, 0.460766, -0.533742), Vector3(-0.395111, 0.460766, -0.533742), Vector3(-0.328358, 0.427181, -0.51408), Vector3(-0.395111, 0.460766, -0.533742), Vector3(0, 0, 0.165806)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_y3yaa"]
_data = {
"RESET": SubResource("Animation_2qp58"),
"rack_slide": SubResource("Animation_bu5vc"),
"recoil": SubResource("Animation_tqkit"),
"reload": SubResource("Animation_g7t13")
}

[sub_resource type="GDScript" id="GDScript_hh8np"]
resource_name = "death_fade"
script/source = "extends ColorRect

@export var from: Color
@export var to: Color

func fade(t: float):
	color = lerp(from, to, t)
"

[sub_resource type="GDScript" id="GDScript_t5u88"]
resource_name = "pause_menu"
script/source = "extends Node

func _ready():
	$Menu.hide()

func _process(_delta):
	if Input.is_action_just_pressed(\"ui_cancel\"):
		if get_tree().paused:
			unpause()
		else:
			pause()

func pause():
	get_tree().paused = true
	$Menu.show()
	Input.mouse_mode = Input.MOUSE_MODE_VISIBLE

func unpause():
	get_tree().paused = false
	$Menu.hide()
	Input.mouse_mode = Input.MOUSE_MODE_CAPTURED
"

[node name="Player" type="Node3D"]
script = ExtResource("1_ugqs2")

[node name="CharacterBody3D" type="CharacterBody3D" parent="." node_paths=PackedStringArray("camera")]
script = ExtResource("2_bxk1o")
camera = NodePath("Node3D/PlayerCamera")

[node name="CollisionShape3D" type="CollisionShape3D" parent="CharacterBody3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.25, 0)
shape = SubResource("CapsuleShape3D_yy7gy")

[node name="CollisionShape3D2" type="CollisionShape3D" parent="CharacterBody3D"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
shape = SubResource("SeparationRayShape3D_d8cd5")

[node name="Node3D" type="Node3D" parent="CharacterBody3D"]

[node name="PlayerCamera" type="Camera3D" parent="CharacterBody3D/Node3D" node_paths=PackedStringArray("body")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
script = ExtResource("2_jgt6g")
body = NodePath("../..")

[node name="PlayerPistol" type="Node3D" parent="CharacterBody3D/Node3D/PlayerCamera" node_paths=PackedStringArray("weapon", "camera", "animation_player", "magazine")]
process_mode = 4
visible = false
script = ExtResource("4_pbdc1")
weapon = NodePath("Pistol")
camera = NodePath("..")
reload_time = 2.0
bullet = ExtResource("7_i1ag6")
animation_player = NodePath("AnimationPlayer")
magazine = NodePath("Pistol/Magazine")

[node name="Pistol" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerPistol" node_paths=PackedStringArray("magazine") instance=ExtResource("4_ujl8y")]
transform = Transform3D(0.945519, -0.325569, 0, 0.325569, 0.945519, 0, 0, 0, 1, 0.05, -0.09, -0.07)
magazine = NodePath("Magazine")

[node name="Magazine" type="Node3D" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerPistol/Pistol"]
script = ExtResource("6_7fstl")
max_rounds = 10

[node name="AnimationPlayer" type="AnimationPlayer" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerPistol"]
libraries = {
"": SubResource("AnimationLibrary_y3yaa")
}

[node name="PlayerSMG" type="Node3D" parent="CharacterBody3D/Node3D/PlayerCamera" node_paths=PackedStringArray("weapon", "camera", "animation_player", "magazine")]
script = ExtResource("4_pbdc1")
weapon = NodePath("SMG")
camera = NodePath("..")
reload_time = 2.0
bullet = ExtResource("7_i1ag6")
animation_player = NodePath("AnimationPlayer")
magazine = NodePath("SMG/Magazine")

[node name="SMG" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerSMG" node_paths=PackedStringArray("magazine", "muzzle") instance=ExtResource("8_6ao76")]
transform = Transform3D(0.986285, -0.165048, 0, 0.165048, 0.986286, 0, 0, 0, 1, 0.05, -0.08, -0.22)
magazine = NodePath("Magazine")
muzzle = NodePath(".")

[node name="Magazine" type="Node3D" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerSMG/SMG"]
script = ExtResource("6_7fstl")
max_rounds = 30

[node name="AnimationPlayer" type="AnimationPlayer" parent="CharacterBody3D/Node3D/PlayerCamera/PlayerSMG"]
libraries = {
"": SubResource("AnimationLibrary_y3yaa")
}

[node name="Components" type="Node" parent="."]

[node name="Nausea" parent="Components" node_paths=PackedStringArray("camera") instance=ExtResource("2_135jv")]
process_mode = 4
camera = NodePath("../../CharacterBody3D/Node3D/PlayerCamera")
length = 10.0
duration = 0.5
speed = 45.0
angle = 180.0

[node name="Health" parent="Components" instance=ExtResource("5_v7jk3")]

[node name="UI" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="DeathFade" type="ColorRect" parent="UI"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
color = Color(0, 0, 0, 0)
script = SubResource("GDScript_hh8np")
from = Color(0, 0, 0, 0)

[node name="Pause" type="Node" parent="UI"]
script = SubResource("GDScript_t5u88")

[node name="Menu" type="Control" parent="UI/Pause"]
process_mode = 2
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="Damage" type="Button" parent="UI/Pause/Menu"]
layout_mode = 0
offset_right = 77.0
offset_bottom = 31.0
text = "DAMAGE"

[node name="Resume" type="Button" parent="UI/Pause/Menu"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -36.0
offset_top = -15.5
offset_right = 36.0
offset_bottom = 15.5
grow_horizontal = 2
grow_vertical = 2
text = "RESUME"

[connection signal="pressed" from="UI/Pause/Menu/Damage" to="Components/Health" method="damage" binds= [5.0]]
[connection signal="pressed" from="UI/Pause/Menu/Resume" to="UI/Pause" method="unpause"]
